<!DOCTYPE html>  <html> <head>   <title>simple-oauth2.js</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               simple-oauth2.js             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>               <p><strong>Node.js client library for <a href="http://oauth.net/2/">OAuth2</a></strong></p>

<p><strong><a href="https://github.com/andreareginato/simple-oauth2">Github repository</a></strong></p>

<p>OAuth2 lets users grant the access to the desired resources to third party applications,
giving them the possibility to enable and disable those accesses whenever they want.</p>

<p>Simple OAuth2 supports the following flows.</p>

<ul>
<li>Authorization Code Flow (for apps with servers that can store persistent information).</li>
<li>Password Credentials (when previous flow can't be used or during development).</li>
</ul>

<h3>Installation</h3>

<pre><code>npm install simple-oauth2
</code></pre>

<h3>Authorization Code flow</h3>

<p>The Authorization Code flow is made up from two parts. At first your application asks to
the user the permission to access their data. If the user approves Lelylan sends to the
client an authorization code. In the second part, the client POST the authorization code
along with its client secret to the Lelylan in order to get the access token.
<a href="auth-code.html">Learn more about</a>.</p>

<pre><code>// Set the client credentials
var credentials = { client: {
  id: '&lt;client-id&gt;',
  secret: '&lt;client-secret&gt;',
  site: 'https://example.org'
}};

// Initialize the OAuth2 Library
var OAuth2 = require('simple-oauth2')(credentials);

// Authorization OAuth2 URI
var authorization_uri = OAuth2.AuthCode.authorizeURL({
  redirect_uri: 'http://localhost:3000/callback'
});

// Redirect example using Express
// See http://expressjs.com/api.html#res.redirect
res.redirect(authorization_uri);

// Get the access token object.
// The authorization code is given from the previous step.
var token;
OAuth2.AuthCode.getToken({
  code: 'authorization-code',
  redirectURI: 'http://localhost:3000/callback'
}, function(error, result) { token = result });

// Create the access token wrapper
var token = OAuth2.AccessToken.create(json_token);

// Check if the token is expired. If expired it is refreshed.
if (token.expired()) {
  token.refresh(function(error, result) {
    token = result;
  })
}
</code></pre>

<h3>Password Credentials Flow</h3>

<p>This flow is suitable when the resource owner has a trust relationship with the
client, such as its computer operating system or a highly privileged application.
Use this flow only when other flows are not viable or when you need a fast way to
test your application. <a href="password.html">Learn more about</a>.</p>

<pre><code>// Get the access token object.
var token;
OAuth2.Password.getToken({
  username: 'username',
  password: 'password'Â 
}, function(error, result) { token = result });
</code></pre>

<h3>Access Token object</h3>

<p>When a token expires we need to refresh it. Simple OAuth2 offers the
AccessToken class that add a couple of useful methods to refresh the
access token when it is expired. <a href="access-token.html">Learn more about</a>.</p>

<pre><code>// Get the access token object.
var token;
OAuth2.AuthCode.getToken({
  code: 'authorization-code',
  redirectURI: 'http://localhost:3000/callback'
}, function(error, result) { token = result });

// Create the access token wrapper
var token = OAuth2.AccessToken.create(json_token);

// Check if the token is expired. If expired it is refreshed.
if (token.expired()) {
  token.refresh(function(error, result) {
    token = result;
  })
}
</code></pre>

<h3>Errors</h3>

<p>Exceptions are raised when a 4xx or 5xx status code is returned.</p>

<pre><code>OAtuh2.HTTPError
</code></pre>

<p>Through the error message attribute you can access the JSON representation
based on HTTP <code>status</code> and error <code>message</code>.</p>

<pre><code>OAuth2.AuthCode.getToken(function(error, token) {
  if (error) { console.log(error.message); }
});
// =&gt; { "status": "401", "message": "Unauthorized" }
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <h3>Configurations</h3>

<p>Simple OAuth2 accepts an object with the following valid params.</p>

<ul>
<li><code>client.id</code> - Required registered Client ID.</li>
<li><code>client.secret</code> - Required registered Client secret.</li>
<li><code>client.site</code> - Required registered Client site.</li>
<li><code>authorizationPath</code> - Authorization path for the OAuth2 server.
Simple Oauth2 uses <code>/oauth/authorization</code> as default</li>
<li><code>tokenPath</code> - Access token path for the OAuth2 server.
Simple Oauth2 uses <code>/oauth/token</code> as default.</li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre><span class="kd">var</span> <span class="nx">appConfig</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./config&#39;</span><span class="p">);</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">config</span><span class="p">)</span> <span class="p">{</span>

  <span class="kd">function</span> <span class="nx">configure</span><span class="p">(</span><span class="nx">config</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">config</span> <span class="o">=</span> <span class="nx">config</span> <span class="o">||</span> <span class="p">{};</span>
    <span class="nx">mergeDefaults</span><span class="p">(</span><span class="nx">config</span><span class="p">,</span> <span class="nx">appConfig</span><span class="p">);</span>
    <span class="k">return</span> <span class="nx">config</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="nx">config</span> <span class="o">=</span> <span class="nx">configure</span><span class="p">(</span><span class="nx">config</span><span class="p">);</span>
  <span class="kd">var</span> <span class="nx">core</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./core&#39;</span><span class="p">)(</span><span class="nx">config</span><span class="p">);</span>

  <span class="kd">function</span> <span class="nx">mergeDefaults</span><span class="p">(</span><span class="nx">o1</span><span class="p">,</span> <span class="nx">o2</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">p</span> <span class="k">in</span> <span class="nx">o2</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">try</span> <span class="p">{</span> <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">o2</span><span class="p">[</span><span class="nx">p</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;object&#39;</span><span class="p">)</span> <span class="p">{</span> <span class="nx">o1</span><span class="p">[</span><span class="nx">p</span><span class="p">]</span> <span class="o">=</span> <span class="nx">mergeDefaults</span><span class="p">(</span><span class="nx">o1</span><span class="p">[</span><span class="nx">p</span><span class="p">],</span> <span class="nx">o2</span><span class="p">[</span><span class="nx">p</span><span class="p">]);</span> <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">o1</span><span class="p">[</span><span class="nx">p</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;undefined&#39;</span><span class="p">)</span> <span class="p">{</span> <span class="nx">o1</span><span class="p">[</span><span class="nx">p</span><span class="p">]</span> <span class="o">=</span> <span class="nx">o2</span><span class="p">[</span><span class="nx">p</span><span class="p">];</span> <span class="p">}</span> <span class="p">}</span>
      <span class="k">catch</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span> <span class="nx">o1</span><span class="p">[</span><span class="nx">p</span><span class="p">]</span> <span class="o">=</span> <span class="nx">o2</span><span class="p">[</span><span class="nx">p</span><span class="p">];</span> <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">o1</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">return</span> <span class="p">{</span>
    <span class="s1">&#39;AuthCode&#39;</span><span class="o">:</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./client/auth-code&#39;</span><span class="p">)(</span><span class="nx">config</span><span class="p">),</span>
    <span class="s1">&#39;Password&#39;</span><span class="o">:</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./client/password&#39;</span><span class="p">)(</span><span class="nx">config</span><span class="p">),</span>
    <span class="s1">&#39;AccessToken&#39;</span><span class="o">:</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./client/access-token&#39;</span><span class="p">)(</span><span class="nx">config</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">};</span>

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html>
